1. 시장 데이터를 먼저 모아요

먼저, 내가 관심 있는 특정 차량(예: 현대 쏘나타, 기아 K5)을 골라냅니다.
그다음 같은 제조사 + 같은 모델에 해당하는 모든 중고차 데이터를 모읍니다.

예를 들어, 내가 보고 있는 차량이 “현대 쏘나타 2019년식”이라면,
데이터에서 “쏘나타”라는 이름을 가진 모든 매물을 가져옵니다.

2. “차령별 대표가격 곡선”을 만듭니다

차는 시간이 지날수록 가격이 떨어집니다.
이를 알기 위해 차령(car_age), 즉 “올해 - 최초 등록연도”를 계산합니다.

0년차: 신차

3년차: 출고 후 3년 된 차

10년차: 출고 후 10년 된 차

이렇게 나이를 기준으로 묶어서, 각 나이에 해당하는 **중고차 가격의 중앙값(중간값)**을 계산합니다.
👉 중앙값을 쓰는 이유는, 평균은 극단적으로 싼 차나 비싼 차에 휘둘리지만 중앙값은 그렇지 않아서 더 안정적이기 때문이에요.

이렇게 해서 “차령 vs. 가격” 그래프를 그리면, 일반적으로 우하향하는 곡선이 나옵니다.

3. 곡선을 부드럽게 다듬어요 (스무딩)

실제 데이터는 들쭉날쭉합니다.
예를 들어, 7년차 차 중에 어떤 건 튜닝이 많이 돼서 비싸게 팔리고, 어떤 건 사고차라서 엄청 싸게 팔릴 수도 있죠.
이런 데이터들이 평균값이나 중앙값에 영향을 줍니다.

그래서 코드는 **3년 이동 중앙값(rolling median)**을 씁니다.
즉, “해당 나이 ±1년” 범위의 데이터를 같이 보면서 중간값을 다시 계산해, 곡선을 매끈하게 만듭니다.
👉 이렇게 하면 “실제 시장에서의 장기적인 추세”를 더 잘 볼 수 있습니다.

4. 가격이 얼마나 빨리 떨어지나? (감가율 계산)

이제 “매년 얼마만큼 떨어지나?”를 계산해야겠죠.

코드에서는 이렇게 합니다:

하락폭(drop) = 전년도 가격 - 올해 가격

감가율(depr_% ) = 가격이 전년 대비 몇 퍼센트 줄었는가

예시:

0년차: 3,000만원 → 1년차: 2,400만원 → 600만원 하락 (20% 감가)

1년차: 2,400만원 → 2년차: 2,100만원 → 300만원 하락 (12.5% 감가)

2년차: 2,100만원 → 3년차: 1,900만원 → 200만원 하락 (9.5% 감가)

이런 식으로 연령별 감가율표가 만들어집니다.

5. 엘보 포인트와 스위트 스팟

이제 감가율표를 이용해 중요한 두 가지 지점을 찾습니다.

엘보 포인트

처음에는 가격이 가파르게 떨어지다가, 어느 순간부터 하락세가 완만해집니다.

이 “급격한 하락 → 완만한 하락”이 바뀌는 지점을 코드에서는 2차 변화량(하락폭이 얼마나 줄었는지)을 계산해서 찾습니다.

쉽게 말하면: “더 이상 가격이 급격히 안 떨어지고 안정화되기 시작하는 시점”이에요.

스위트 스팟

가성비가 좋은 시점, 즉 가격이 시장 중앙값 이하이면서 연간 감가율도 10% 미만인 구간.

단발성으로 딱 1년만 해당되는 게 아니라, 연속된 구간을 찾아내서 가장 긴 구간을 표시합니다.

쉽게 말하면: “가격도 합리적이고, 급격히 안 떨어지며, 가성비가 좋은 황금 구간”입니다.

6. 내 차의 미래가격을 예측해요

이제 마지막 단계는 내가 선택한 특정 매물(vehicleid)의 미래 가격을 예측하는 겁니다.

현재 나이와 가격을 시작점으로 둡니다. (예: 3년차, 2,000만원)

앞으로 1년차 가격 = 현재 가격 × (1 - 해당 연령대 감가율)

그다음 2년차 가격 = 직전 가격 × (1 - 다음 연령대 감가율)

이렇게 해마다 곱해가며 5년 뒤, 10년 뒤 가격까지 예측합니다.
만약 그 연령대의 감가율 데이터가 없으면, 마지막 몇 년의 평균 감가율을 대신 써서 예측을 이어갑니다.

👉 결과적으로, 내가 지금 보고 있는 차가 앞으로 몇 년 뒤 얼마쯤 될지를 “평균 시장 패턴”을 기반으로 보여줍니다.

7. 시각화로 보여주기

코드에서는 이 결과를 두 가지 그래프로 보여줍니다.

모델 전체 감가상각 곡선 (중앙값 기반, 엘보 포인트, 스위트 스팟 표시)

내 차의 미래 가격 예측 곡선 (현재 위치와 1년 뒤, 2년 뒤, … 가격 라벨 표시)

한 줄 요약

이 코드는

같은 모델 차들의 데이터를 모아서 “차령별 평균적인 가격 곡선”을 만들고,

그 곡선에서 감가율을 추정해서,

내가 고른 매물의 현재가에 그 감가율을 순차적으로 곱해,
👉 내 차가 앞으로 몇 년 뒤 얼마쯤 될지 예측해주는 구조입니다.
